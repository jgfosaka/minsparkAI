{% extends "base.html" %}
{% block content %}
<div class="container mt-4 flashcard-page">
  <h2 class="text-light text-center mb-4">Seus Flashcards</h2>

  {% if flashcards %}
    <div class="flashcard-grid">
      {% for card in flashcards %}
        <div class="flashcard-card">
            <div class="card-body">

              <h5 class="card-title text-warning">Pergunta</h5>
              <p class="card-text">{{ card.pergunta }}</p>

              <!-- Alternativas -->
              <ul class="alt-list">
                {% if card.alt_a %}<li>{{ card.alt_a }}</li>{% endif %}
                {% if card.alt_b %}<li>{{ card.alt_b }}</li>{% endif %}
                {% if card.alt_c %}<li>{{ card.alt_c }}</li>{% endif %}
                {% if card.alt_d %}<li>{{ card.alt_d }}</li>{% endif %}
              </ul>

              <!-- Mostrar Resposta -->
              <button 
                type="button"
                class="btn btn-sm btn-outline-light mb-2 btn-mostrar"
                data-target="{{ 'resp-' ~ card.id }}"
              >
                Mostrar Resposta
              </button>

              <p id="resp-{{ card.id }}" class="resposta-card d-none">
                {{ card.resposta }}
              </p>

              <!-- Acertar / Errar -->
              <div class="btn-row">
                <button 
                  type="button"
                  class="btn btn-success btn-sm btn-acertar"
                  data-id="{{ card.id }}">
                  Acertar
                </button>

                <form 
                  action="{{ url_for('responder', flashcard_id=card.id, resultado='erro') }}"
                  method="post"
                >
                  <button type="submit" class="btn btn-danger btn-sm">Errar</button>
                </form>
              </div>

            </div>
        </div>
      {% endfor %}
    </div>

    <!-- Scripts -->
    <script>
document.addEventListener('DOMContentLoaded', () => {

  // Alternar resposta
  document.querySelectorAll('.btn-mostrar').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.target;
      const el = document.getElementById(targetId);
      if (!el) return;
      el.classList.toggle('d-none');
      btn.textContent = el.classList.contains('d-none') ? 'Mostrar Resposta' : 'Esconder Resposta';
    });
  });

  // Acertar -> remover card
  document.querySelectorAll('.btn-acertar').forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.dataset.id;
      const card = btn.closest('.flashcard-card');

      try {
        const resp = await fetch(`/responder/${id}/acerto`, { method: 'POST' });

        if (resp.ok) {
          card.style.transition = "opacity 0.4s ease, transform 0.4s ease";
          card.style.opacity = "0";
          card.style.transform = "scale(0.9)";
          setTimeout(() => card.remove(), 400);
        }
      } catch (err) {
        alert("Erro ao registrar acerto.");
      }
    });
  });

});
    </script>

  {% else %}
    <p id="ainda" class="text-center">Você ainda não possui flashcards.</p>
  {% endif %}
</div>
{% endblock %}
